# Copyright (C) 1998-2000  Internet Software Consortium.
# 
# Permission to use, copy, modify, and distribute this software for any
# purpose with or without fee is hereby granted, provided that the above
# copyright notice and this permission notice appear in all copies.
# 
# THE SOFTWARE IS PROVIDED "AS IS" AND INTERNET SOFTWARE CONSORTIUM DISCLAIMS
# ALL WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES
# OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL INTERNET SOFTWARE
# CONSORTIUM BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
# DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
# PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS
# ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS
# SOFTWARE.

# $Id: Makefile.in,v 1.93 2000/06/22 21:54:14 tale Exp $

srcdir =	@srcdir@
VPATH =		@srcdir@
top_srcdir =	@top_srcdir@

@BIND9_VERSION@

@LIBDNS_API@

@BIND9_INCLUDES@

CINCLUDES =	-I. ${DNS_INCLUDES} ${ISC_INCLUDES}

CDEFINES =
CWARNINGS =

LIBS =		@LIBS@

# Alphabetically

CONFOBJS =	config/confacl.@O@ config/confcache.@O@ config/confcommon.@O@ \
		config/confctl.@O@ config/confctx.@O@ \
		config/confip.@O@ config/confkeys.@O@ \
		config/conflog.@O@ config/conflsn.@O@ \
		config/confndc.@O@ config/confparser.@O@ \
		config/confresolv.@O@ config/confrrset.@O@ \
		config/confview.@O@ config/confzone.@O@

DSTOBJS =	sec/dst/bsafe_link.@O@ sec/dst/dst_api.@O@ \
		sec/dst/dst_parse.@O@ sec/dst/hmac_link.@O@ \
		sec/dst/openssl_link.@O@ sec/dst/openssldh_link.@O@ \
		sec/dst/dst_result.@O@ \
		sec/dst/dst_support.@O@ sec/dst/dst_lib.@O@

OPENSSLOBJS =	sec/openssl/bn_add.@O@ sec/openssl/bn_asm.@O@ \
		sec/openssl/bn_ctx.@O@ sec/openssl/bn_div.@O@ \
		sec/openssl/bn_err.@O@ sec/openssl/bn_exp.@O@ \
		sec/openssl/bn_exp2.@O@ sec/openssl/bn_gcd.@O@ \
		sec/openssl/bn_lib.@O@ sec/openssl/bn_mont.@O@ \
		sec/openssl/bn_mul.@O@ sec/openssl/bn_prime.@O@ \
		sec/openssl/bn_print.@O@ sec/openssl/bn_rand.@O@ \
		sec/openssl/bn_recp.@O@ sec/openssl/bn_shift.@O@ \
		sec/openssl/bn_sqr.@O@ sec/openssl/bn_word.@O@ \
		sec/openssl/buffer.@O@ sec/openssl/cryptlib.@O@ \
		sec/openssl/dh_err.@O@ sec/openssl/dh_gen.@O@ \
		sec/openssl/dh_key.@O@  sec/openssl/dh_lib.@O@ \
		sec/openssl/dsa_asn1.@O@ sec/openssl/dsa_err.@O@ \
		sec/openssl/dsa_gen.@O@ sec/openssl/dsa_key.@O@ \
		sec/openssl/dsa_lib.@O@  sec/openssl/dsa_ossl.@O@ \
		sec/openssl/dsa_sign.@O@ sec/openssl/dsa_vrf.@O@ \
		sec/openssl/err.@O@ sec/openssl/ex_data.@O@ \
		sec/openssl/lhash.@O@ sec/openssl/mem_dbg.@O@ \
		sec/openssl/mem.@O@ sec/openssl/rand_lib.@O@ \
		sec/openssl/sha1_one.@O@ sec/openssl/sha1dgst.@O@ \
		sec/openssl/stack.@O@ sec/openssl/th-lock.@O@

DNSSAFEOBJS =	sec/dnssafe/ahchdig.@O@ sec/dnssafe/ahchencr.@O@ \
		sec/dnssafe/ahchgen.@O@ sec/dnssafe/ahchrand.@O@ \
		sec/dnssafe/ahdigest.@O@ sec/dnssafe/ahencryp.@O@ \
		sec/dnssafe/ahgen.@O@ sec/dnssafe/ahrandom.@O@ \
		sec/dnssafe/ahrsaenc.@O@ sec/dnssafe/ahrsaepr.@O@ \
		sec/dnssafe/ahrsaepu.@O@ sec/dnssafe/aichdig.@O@ \
		sec/dnssafe/aichenc8.@O@ sec/dnssafe/aichencn.@O@ \
		sec/dnssafe/aichencr.@O@ sec/dnssafe/aichgen.@O@ \
		sec/dnssafe/aichrand.@O@ sec/dnssafe/aimd5.@O@ \
		sec/dnssafe/aimd5ran.@O@ sec/dnssafe/ainfotyp.@O@ \
		sec/dnssafe/ainull.@O@ sec/dnssafe/airsaepr.@O@ \
		sec/dnssafe/airsaepu.@O@ sec/dnssafe/airsakgn.@O@ \
		sec/dnssafe/airsaprv.@O@ sec/dnssafe/airsapub.@O@ \
		sec/dnssafe/algchoic.@O@ sec/dnssafe/algobj.@O@ \
		sec/dnssafe/amcrte.@O@ sec/dnssafe/ammd5.@O@ \
		sec/dnssafe/ammd5r.@O@ sec/dnssafe/amrkg.@O@ \
		sec/dnssafe/amrsae.@O@ \
		sec/dnssafe/balg.@O@ sec/dnssafe/bgclrbit.@O@ \
		sec/dnssafe/bgmdmpyx.@O@ sec/dnssafe/bgmdsqx.@O@ \
		sec/dnssafe/bgmodexp.@O@ sec/dnssafe/bgpegcd.@O@ \
		sec/dnssafe/big2exp.@O@ sec/dnssafe/bigabs.@O@ \
		sec/dnssafe/bigacc.@O@ sec/dnssafe/bigarith.@O@ \
		sec/dnssafe/bigcmp.@O@ sec/dnssafe/bigconst.@O@ \
		sec/dnssafe/biginv.@O@ sec/dnssafe/biglen.@O@ \
		sec/dnssafe/bigmodx.@O@ sec/dnssafe/bigmpy.@O@ \
		sec/dnssafe/bigpdiv.@O@ sec/dnssafe/bigpmpy.@O@ \
		sec/dnssafe/bigpmpyh.@O@ sec/dnssafe/bigpmpyl.@O@ \
		sec/dnssafe/bigpsq.@O@ sec/dnssafe/bigqrx.@O@ \
		sec/dnssafe/bigsmod.@O@ sec/dnssafe/bigtocan.@O@ \
		sec/dnssafe/bigu.@O@ sec/dnssafe/bigunexp.@O@ \
		sec/dnssafe/binfocsh.@O@ sec/dnssafe/bkey.@O@ \
		sec/dnssafe/bmempool.@O@ sec/dnssafe/cantobig.@O@ \
		sec/dnssafe/crt2.@O@ sec/dnssafe/digest.@O@ \
		sec/dnssafe/digrand.@O@ sec/dnssafe/encrypt.@O@ \
		sec/dnssafe/generate.@O@ sec/dnssafe/intbits.@O@ \
		sec/dnssafe/intitem.@O@ sec/dnssafe/keyobj.@O@ \
		sec/dnssafe/ki8byte.@O@ sec/dnssafe/kiitem.@O@ \
		sec/dnssafe/kinfotyp.@O@ sec/dnssafe/kifulprv.@O@ \
		sec/dnssafe/kipkcrpr.@O@ sec/dnssafe/kirsacrt.@O@ \
		sec/dnssafe/kirsapub.@O@ sec/dnssafe/md5.@O@ \
		sec/dnssafe/md5rand.@O@ sec/dnssafe/prime.@O@ \
		sec/dnssafe/random.@O@ sec/dnssafe/rsa.@O@ \
		sec/dnssafe/rsakeygn.@O@ sec/dnssafe/seccbcd.@O@ \
		sec/dnssafe/seccbce.@O@ sec/dnssafe/surrendr.@O@

# Alphabetically
OBJS =		a6.@O@ acl.@O@ aclconf.@O@ adb.@O@ byaddr.@O@ \
		cache.@O@ callbacks.@O@ compress.@O@ \
		db.@O@ dbiterator.@O@ dbtable.@O@ dispatch.@O@ dnssec.@O@ \
		journal.@O@ keytable.@O@ lib.@O@ log.@O@ \
		master.@O@ masterdump.@O@ message.@O@ \
		name.@O@ ncache.@O@ nxt.@O@ peer.@O@ \
		rbt.@O@ rbtdb.@O@ rbtdb64.@O@ rdata.@O@ rdatalist.@O@ \
		rdataset.@O@ rdatasetiter.@O@ rdataslab.@O@ request.@O@ \
		resolver.@O@ result.@O@ rootns.@O@ ssu.@O@ \
		tcpmsg.@O@ time.@O@ tkey.@O@ tkeyconf.@O@ \
		tsig.@O@ tsigconf.@O@ ttl.@O@ validator.@O@ \
		version.@O@ view.@O@ xfrin.@O@ zone.@O@ zoneconf.@O@ zt.@O@ \
		${DSTOBJS} @DST_OPENSSL_OBJS@ ${DNSSAFEOBJS} ${CONFOBJS}

# Alphabetically
SRCS =		a6.c acl.c aclconf.c adb.c byaddr.c \
		cache.c callbacks.c compress.c \
		db.c dbiterator.c dbtable.c dispatch.c dnssec.c \
		journal.c keytable.c lib.c log.c \
		master.c masterdump.c message.c \
		name.c ncache.c nxt.c peer.c \
		rbt.c rbtdb.c rbtdb64.c rdata.c rdatalist.c \
		rdataset.c rdatasetiter.c rdataslab.c request.c \
		resolver.c result.c rootns.c ssu.c \
		tcpmsg.c time.c tkey.c tkeyconf.c \
		tsig.c tsigconf.c ttl.c validator.c \
		version.c view.c xfrin.c zone.c zoneconf.c zt.c

SUBDIRS =	include sec config
TARGETS =	include/dns/enumtype.h include/dns/enumclass.h \
		include/dns/rdatastruct.h timestamp

DEPENDEXTRA =	./gen -F include/dns/rdatastruct.h \
		-s ${srcdir} -d >> Makefile ;

@BIND9_MAKE_RULES@

version.@O@: version.c
	${LIBTOOL} ${CC} ${ALL_CFLAGS} \
		-DVERSION=\"${VERSION}\" \
		-DLIBINTERFACE=${LIBINTERFACE} \
		-DLIBREVISION=${LIBREVISION} \
		-DLIBAGE=${LIBAGE} \
		-c ${srcdir}/version.c

libdns.@SA@: ${OBJS}
	${AR} ${ARFLAGS} $@ ${OBJS}
	${RANLIB} $@

libdns.la: ${OBJS}
	${LIBTOOL} --mode=link \
		${CC} ${ALL_CFLAGS} -o libdns.la -rpath ${libdir} \
		-version-info ${LIBINTERFACE}:${LIBREVISION}:${LIBAGE} \
		${OBJS} ${LIBS}

timestamp: libdns.@A@
	touch timestamp

installdirs:
	if [ ! -d ${DESTDIR}${libdir} ]; then \
		mkdir ${DESTDIR}${libdir} ; \
	fi

install:: timestamp installdirs
	${LIBTOOL} ${INSTALL_DATA} libdns.@A@ ${DESTDIR}${libdir}

clean distclean::
	rm -f libdns.@A@ timestamp
	rm -f gen code.h include/dns/enumtype.h include/dns/enumclass.h
	rm -f include/dns/rdatastruct.h

newrr::
	rm -f code.h include/dns/enumtype.h include/dns/enumclass.h
	rm -f include/dns/rdatastruct.h

include: include/dns/enumtype.h include/dns/enumclass.h \
	include/dns/rdatastruct.h

rdata.@O@: code.h

include/dns/enumtype.h: gen
	./gen -s ${srcdir} -t > $@

include/dns/enumclass.h: gen
	./gen -s ${srcdir} -c > $@

include/dns/rdatastruct.h: gen \
		${srcdir}/rdata/rdatastructpre.h \
		${srcdir}/rdata/rdatastructsuf.h
	./gen -s ${srcdir} -i \
		-P ${srcdir}/rdata/rdatastructpre.h \
		-S ${srcdir}/rdata/rdatastructsuf.h > $@

code.h:	gen
	./gen -s ${srcdir} > code.h

gen: gen.c
	${CC} ${ALL_CFLAGS} -o $@ ${srcdir}/gen.c ${LIBS}

rbtdb64.@O@: rbtdb.c

depend: include/dns/enumtype.h include/dns/enumclass.h \
	include/dns/rdatastruct.h code.h
subdirs: include/dns/enumtype.h include/dns/enumclass.h \
	include/dns/rdatastruct.h code.h
