From: =?utf-8?b?T25kxZllaiBTdXLDvQ==?= <ondrej@sury.org>
Date: Tue, 21 May 2019 17:51:41 +0000
Subject: Include config.h from gen.c to get the correct platform
 compatibility

On some systems (namely Debian buster armhf) the readdir() call fails
with `Value too large for defined data type` unless the
_FILE_OFFSET_BITS=64 is defined.  The most easy way to fix this is
to include the top level <config.h> header from gen.c.
---
 lib/dns/Makefile.in | 3 ++-
 lib/dns/gen.c       | 2 ++
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/lib/dns/Makefile.in b/lib/dns/Makefile.in
index bfc694e..038a766 100644
--- a/lib/dns/Makefile.in
+++ b/lib/dns/Makefile.in
@@ -182,7 +182,8 @@ code.h:	gen
 	./gen -s ${srcdir} > code.h || { rm -f $@ ; exit 1; }
 
 gen: gen.c
-	${BUILD_CC} ${BUILD_CFLAGS} -I${top_srcdir}/lib/isc/include \
+	${BUILD_CC} ${BUILD_CFLAGS} \
+	${ALWAYS_INCLUDES} ${ALWAYS_DEFINES} ${ISC_INCLUDES} \
 	${BUILD_CPPFLAGS} ${BUILD_LDFLAGS} -o $@ ${srcdir}/gen.c ${BUILD_LIBS}
 
 timestamp: include libdns.@A@
diff --git a/lib/dns/gen.c b/lib/dns/gen.c
index 5396303..84c616f 100644
--- a/lib/dns/gen.c
+++ b/lib/dns/gen.c
@@ -24,6 +24,8 @@
 #endif
 #endif
 
+#include <config.h>
+
 #include <sys/types.h>
 
 #include <ctype.h>
